<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/markdown/java-settings.md at 2025-03-03
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>digilib - The Digital Image Library &#x2013; Java VM memory settings for digilib</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://robcast.github.io/digilib/" id="bannerLeft"><h2>digilib - a versatile image viewing environment for the internet</h2>
</a></div>
          <div class="pull-right"><a href="https://robcast.github.io/digilib/" id="bannerRight"><img src="images/digilib-logo-small.png"  alt=""/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2025-03-03<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.12-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="About digilib"><span class="none"></span>About digilib</a></li>
    <li><a href="features.html" title="digilib features"><span class="none"></span>digilib features</a></li>
    <li><a href="digilib-short.html" title="How digilib works"><span class="none"></span>How digilib works</a></li>
    <li><a href="history.html" title="Ancient history"><span class="none"></span>Ancient history</a></li>
   <li class="nav-header">Installation</li>
    <li><a href="build-maven.html" title="Building digilib"><span class="none"></span>Building digilib</a></li>
    <li><a href="install-digilib.html" title="Installing digilib"><span class="none"></span>Installing digilib</a></li>
    <li><a href="server-setup.html" title="Server setup"><span class="none"></span>Server setup</a></li>
    <li><a href="digilib-docker.html" title="digilib in Docker"><span class="none"></span>digilib in Docker</a></li>
   <li class="nav-header">Configuration</li>
    <li><a href="digilib-config.html" title="Configuring digilib"><span class="none"></span>Configuring digilib</a></li>
    <li><a href="image-directories.html" title="Directory layout"><span class="none"></span>Directory layout</a></li>
    <li class="active"><a href="#"><span class="none"></span>Java settings and tuning</a></li>
    <li><a href="auth.html" title="Access control"><span class="none"></span>Access control</a></li>
    <li><a href="pdf-generator.html" title="PDF generation"><span class="none"></span>PDF generation</a></li>
   <li class="nav-header">Development</li>
    <li><a href="scaler-api.html" title="The digilib Scaler API"><span class="none"></span>The digilib Scaler API</a></li>
    <li><a href="iiif-api.html" title="The digilib IIIF API"><span class="none"></span>The digilib IIIF API</a></li>
    <li><a href="client-integration.html" title="Integrating digilib into your page"><span class="none"></span>Integrating digilib into your page</a></li>
    <li><a href="plugins.html" title="Digilib plugins"><span class="none"></span>Digilib plugins</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="builtBy"><img class="builtBy"  alt="Built by Maven" src="https://maven.apache.org/images/logos/maven-feather.png"    /></a>
<a href="../../" title="Hosted by GitHub" class="builtBy"><img class="builtBy"  alt="Hosted by GitHub" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Logo.png"   width="100px"  /></a>
<a href="http://www.sourceforge.net/" title="Previously hosted by SourceForge" class="builtBy"><img class="builtBy"  alt="Previously hosted by SourceForge" src="https://upload.wikimedia.org/wikipedia/commons/0/0b/Sourceforge_logo.png"   width="100px"  /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Java VM memory settings for digilib</h1>
<p>(Robert Casties, September 2013)</p>
<p>The Java virtual machine (Java-VM) only uses a fixed amount of memory for its operations. When an operation needs more memory than available it aborts with an error (&#x201c;out of memory error&#x201d;).</p>
<p>digilib can need a lot of memory depending on the size and type of images. Since digilib runs as a servlet under Tomcat its in the same VM as the Tomcat server.</p>
<p>The amount of memory Tomcat (version 5.0) uses is configured by creating a <code>setenv.sh</code> (or <code>setenbv.bat</code>) script with a line</p>

<div class="source">
<div class="source"><pre class="prettyprint">CATALINA_OPTS=&quot;-Xmx512m&quot;
</pre></div></div>

<p>in Tomcat&#x2019;s <code>bin</code> directory (giving 512MB RAM in this case).</p>
<p>You can check the amount of memory your digilib instance has available on the bottom of the web page <code>/server/dlConfig.jsp</code> in your digilib instance (e.g. <a class="externalLink" href="http://localhost:8080/digilib/server/dlConfig.jsp">http://localhost:8080/digilib/server/dlConfig.jsp</a></p>
<h1>Installing JAI ImageIO</h1>
<p>(Robert Casties, September 2013)</p>
<p>In principle you should be able to install the <a class="externalLink" href="http://java.sun.com/javase/technologies/desktop/media/jai/">Java Advanced Imaging</a> JAI-ImageIO JAR file <code>jai_imageio.jar</code> (and native library files if available) in the <code>/WEB-INF/lib/</code> directory of the digilib web application as part of the default installation.</p>
<p>You can see if the Jai-ImageIO plugin is active by checking for the availability of the TIFF image format under &#x201c;Supported image types&#x201d; on the <a class="externalLink" href="http://localhost:8080/digilib/server/dlConfig.jsp"><code>/server/dlConfig.jsp</code></a> status page.</p>
<p>Sometimes there are problems with leaking memory. Newer versions of Tomcat refuse to load the libraries (see JREMemoryLeakPreventionListener) and I found that in some cases digilib stopped reading TIFF files after a period of running. In these cases it helped to install the JAI files in Tomcats <code>lib/</code> directory or globally in the local Java JDK installation (i.e. in the Java&#x2019;s &#x2018;jre/lib/ext/&#x2019; directory on linux).</p>
<p>If you really need to have the imageio-plugins JAR inside the web app, please consider using Harald Kuhrs <a class="externalLink" href="https://github.com/haraldk/TwelveMonkeys#deploying-the-plugins-in-a-web-app">IIOProviderContextListener</a>.</p>
<h1>Codec availability and Performance</h1>
<p>(Ubbo Veentjer, Oct 2015)</p>
<p>The number of image formats, which digilib may read or write, but also the performance of operating on this image formats depends on the ImageIO readers and writers available on the classpath.</p>
<p>Working with larger images in JPEG format we experienced a big performance difference using different implementations of the JPEG readers/writers. OpenJDK-7 for example brings rather slow JPEG codecs, OpenJDK-8 operates much quicker on JPEG images, relying on libjpeg-turbo for this file format. Also the official Oracle-JDKs may include faster native codecs.</p>
<p>Some drop-in replacements for the native codecs are:</p>
<ul>

<li><a class="externalLink" href="https://github.com/geosolutions-it/imageio-ext">https://github.com/geosolutions-it/imageio-ext</a></li>
<li><a class="externalLink" href="https://github.com/haraldk/TwelveMonkeys">https://github.com/haraldk/TwelveMonkeys</a></li>
</ul>
<p>if these jar files are availabe on the classpath, the codecs may be used by digilib. To add them the jar files could e.g. be placed in the lib directory of tomcat or addded as a dependency to the digilib maven project.</p>
<p>The actual codec implementation used is logged by digilib in debug mode, e.g.</p>

<div class="source">
<div class="source"><pre class="prettyprint">1564059 [http-apr-9092-exec-4] DEBUG digilib.image.DocuImage  - ImageIO: this reader: class com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageReader
</pre></div></div>

<p>(Robert Casties, Oct 2015)</p>
<p>You can now use the TwelveMonkeys codecs instead of the default JAI-ImageIO by just <a href="build-maven.html">building digilib</a> with the Maven-Parameter <code>imageio=12m</code>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">mvn -Dimageio=12m package
</pre></div></div>

<h1>Codec performance</h1>
<p>(Ubbo Veentjer, Oct 2015)</p>
<p>In our tests comparing the performance of OpenJDK7, OpenJDK8, imageio-ext and TwelveMonkeys codecs we experienced the following numbers for decoding, encoding and scaling a 4968px*5968px JPEG file with a color profile to 50% size:</p>

<div class="source">
<div class="source"><pre class="prettyprint">24801 ms - OpenJDK7
11507 ms - OpenJDK7 with com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageReader
4216 ms - OpenJDK7 with imageio-ext using libjpeg-turbo
3635 ms - OpenJDK8 
</pre></div></div>

<p>This numbers may depend on the actual implementation used, the processing power of the CPU and many other factors, to this is just meant to be a rough hint.</p>
<p>For using imageio-ext, the native library needs to be available with the <code>LD_LIBRARY_PATH</code> environment variable (compare: <a class="externalLink" href="https://github.com/geosolutions-it/imageio-ext/wiki/TurboJPEG-plugin">https://github.com/geosolutions-it/imageio-ext/wiki/TurboJPEG-plugin</a>), also the .jar archives need to be on the classpath.</p>
<p>For using the TwelveMonkey Codecs we added the following jars to the tomcat lib directory, which were retrieved by maven (dependency on imageio-jpeg-3.1.2):</p>
<ul>

<li>common-image-3.1.2.jar</li>
<li>common-lang-3.1.2.jar</li>
<li>imageio-jpeg-3.1.2.jar</li>
<li>common-io-3.1.2.jar</li>
<li>imageio-core-3.1.2.jar</li>
<li>imageio-metadata-3.1.2.jar</li>
</ul>
<h1>Available image formats</h1>
<p>(Ubbo Veentjer, Oct 2015)</p>
<p>Digilib logs on startup which image formats are supported, e.g:</p>

<div class="source">
<div class="source"><pre class="prettyprint">9763 [localhost-startStop-1] INFO digilib.conf.DigilibConfiguration  - DocuImage supported image formats: raw, jpeg, tif, WBMP, pcx, PNM, JPG, wbmp, JPEG, PNG, jpeg 2000, tiff, BMP, JPEG2000, RAW, jpeg2000, GIF, TIF, TIFF, bmp, jpg, PCX, pnm, png, gif,
</pre></div></div>

<p>by adding e.g. TwelveMonkeys or image-io ext codecs, more codecs could become available.</p>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2001&#x2013;2025<a href="https://robcast.github.io/digilib/">digilib Community</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
